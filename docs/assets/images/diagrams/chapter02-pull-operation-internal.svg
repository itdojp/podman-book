<svg width="900" height="700" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font: 700 18px Inter, sans-serif; fill: var(--color-text-primary, #1a202c); }
      .section-title { font: 600 14px Inter, sans-serif; fill: var(--color-text-primary, #1a202c); }
      .step-title { font: 600 13px Inter, sans-serif; fill: var(--color-text-primary, #1a202c); }
      .layer-text { font: 500 12px Inter, sans-serif; fill: var(--color-text-primary, #1a202c); }
      .component-text { font: 400 11px Inter, sans-serif; fill: var(--color-text-secondary, #4a5568); }
      .small-text { font: 400 10px Inter, sans-serif; fill: var(--color-text-secondary, #4a5568); }
      
      .registry { fill: var(--color-blue-50, #ebf8ff); stroke: var(--color-blue-200, #90cdf4); }
      .podman-client { fill: var(--color-green-50, #f0fff4); stroke: var(--color-green-200, #68d391); }
      .manifest { fill: var(--color-purple-50, #faf5ff); stroke: var(--color-purple-200, #c084fc); }
      .layer { fill: var(--color-orange-50, #fffaf0); stroke: var(--color-orange-200, #fbb962); }
      .storage { fill: var(--color-yellow-50, #fffff0); stroke: var(--color-yellow-200, #f6e05e); }
      .process { fill: var(--color-red-50, #fef5e7); stroke: var(--color-red-200, #fc8181); }
      .step { fill: var(--color-indigo-50, #f0f9ff); stroke: var(--color-indigo-200, #a5b4fc); }
      .arrow { stroke: var(--color-gray-600, #718096); fill: var(--color-gray-600, #718096); }
      .flow-arrow { stroke: var(--color-blue-500, #3182ce); fill: var(--color-blue-500, #3182ce); stroke-width: 2; }
    </style>
  </defs>

  <!-- Title -->
  <text x="450" y="30" text-anchor="middle" class="title">Podman Pull操作内部処理図</text>

  <!-- Registry Side -->
  <g id="registry">
    <rect x="50" y="60" width="200" height="300" class="registry" />
    <text x="150" y="85" text-anchor="middle" class="section-title">Container Registry</text>
    <text x="150" y="105" text-anchor="middle" class="component-text">(Docker Hub, Quay.io等)</text>
    
    <!-- Manifest -->
    <rect x="70" y="120" width="160" height="50" class="manifest" />
    <text x="150" y="140" text-anchor="middle" class="layer-text">Image Manifest</text>
    <text x="150" y="155" text-anchor="middle" class="small-text">メタデータ、レイヤー情報</text>
    
    <!-- Layers in Registry -->
    <rect x="70" y="185" width="160" height="35" class="layer" />
    <text x="150" y="200" text-anchor="middle" class="component-text">Layer 1: base OS</text>
    <text x="150" y="212" text-anchor="middle" class="small-text">sha256:abc123...</text>
    
    <rect x="70" y="225" width="160" height="35" class="layer" />
    <text x="150" y="240" text-anchor="middle" class="component-text">Layer 2: runtime</text>
    <text x="150" y="252" text-anchor="middle" class="small-text">sha256:def456...</text>
    
    <rect x="70" y="265" width="160" height="35" class="layer" />
    <text x="150" y="280" text-anchor="middle" class="component-text">Layer 3: application</text>
    <text x="150" y="292" text-anchor="middle" class="small-text">sha256:ghi789...</text>
    
    <!-- Config -->
    <rect x="70" y="310" width="160" height="35" class="manifest" />
    <text x="150" y="325" text-anchor="middle" class="component-text">Image Config</text>
    <text x="150" y="337" text-anchor="middle" class="small-text">実行設定、環境変数</text>
  </g>

  <!-- Podman Client Side -->
  <g id="podman-client">
    <rect x="650" y="60" width="200" height="300" class="podman-client" />
    <text x="750" y="85" text-anchor="middle" class="section-title">Podman Client</text>
    
    <!-- Local Cache Check -->
    <rect x="670" y="120" width="160" height="40" class="storage" />
    <text x="750" y="135" text-anchor="middle" class="layer-text">Local Cache Check</text>
    <text x="750" y="150" text-anchor="middle" class="small-text">既存イメージ確認</text>
    
    <!-- Image Store -->
    <rect x="670" y="170" width="160" height="80" class="storage" />
    <text x="750" y="190" text-anchor="middle" class="layer-text">Image Store</text>
    <text x="750" y="205" text-anchor="middle" class="small-text">~/.local/share/containers/</text>
    <text x="750" y="220" text-anchor="middle" class="small-text">storage/overlay/</text>
    <text x="750" y="235" text-anchor="middle" class="small-text">レイヤーキャッシュ</text>
    
    <!-- Layer Assembly -->
    <rect x="670" y="260" width="160" height="50" class="process" />
    <text x="750" y="280" text-anchor="middle" class="layer-text">Layer Assembly</text>
    <text x="750" y="295" text-anchor="middle" class="small-text">OverlayFS結合</text>
    
    <!-- Final Image -->
    <rect x="670" y="320" width="160" height="30" class="podman-client" />
    <text x="750" y="340" text-anchor="middle" class="layer-text">Ready Image</text>
  </g>

  <!-- Process Steps -->
  <g id="process-steps">
    <text x="450" y="400" text-anchor="middle" class="section-title">Pull操作ステップ</text>
    
    <!-- Step 1 -->
    <rect x="50" y="420" width="160" height="60" class="step" />
    <text x="130" y="440" text-anchor="middle" class="step-title">1. 名前解決</text>
    <text x="130" y="455" text-anchor="middle" class="small-text">イメージ名→レジストリURL</text>
    <text x="130" y="470" text-anchor="middle" class="small-text">タグ解析、認証確認</text>
    
    <!-- Step 2 -->
    <rect x="220" y="420" width="160" height="60" class="step" />
    <text x="300" y="440" text-anchor="middle" class="step-title">2. Manifest取得</text>
    <text x="300" y="455" text-anchor="middle" class="small-text">GET /v2/{name}/manifests/{tag}</text>
    <text x="300" y="470" text-anchor="middle" class="small-text">レイヤー一覧取得</text>
    
    <!-- Step 3 -->
    <rect x="390" y="420" width="160" height="60" class="step" />
    <text x="470" y="440" text-anchor="middle" class="step-title">3. レイヤー確認</text>
    <text x="470" y="455" text-anchor="middle" class="small-text">ローカルキャッシュチェック</text>
    <text x="470" y="470" text-anchor="middle" class="small-text">必要レイヤー特定</text>
    
    <!-- Step 4 -->
    <rect x="560" y="420" width="160" height="60" class="step" />
    <text x="640" y="440" text-anchor="middle" class="step-title">4. レイヤーダウンロード</text>
    <text x="640" y="455" text-anchor="middle" class="small-text">並列ダウンロード</text>
    <text x="640" y="470" text-anchor="middle" class="small-text">チェックサム検証</text>
    
    <!-- Step 5 -->
    <rect x="730" y="420" width="120" height="60" class="step" />
    <text x="790" y="440" text-anchor="middle" class="step-title">5. 保存・結合</text>
    <text x="790" y="455" text-anchor="middle" class="small-text">ストレージ保存</text>
    <text x="790" y="470" text-anchor="middle" class="small-text">メタデータ更新</text>
  </g>

  <!-- Detailed Process Flow -->
  <g id="detailed-flow">
    <text x="450" y="520" text-anchor="middle" class="section-title">詳細処理フロー</text>
    
    <!-- Authentication -->
    <rect x="50" y="540" width="120" height="40" class="process" />
    <text x="110" y="555" text-anchor="middle" class="component-text">認証処理</text>
    <text x="110" y="570" text-anchor="middle" class="small-text">Bearer Token</text>
    
    <!-- Registry API Calls -->
    <rect x="190" y="540" width="140" height="40" class="process" />
    <text x="260" y="555" text-anchor="middle" class="component-text">Registry API Call</text>
    <text x="260" y="570" text-anchor="middle" class="small-text">HTTP/2, TLS</text>
    
    <!-- Layer Processing -->
    <rect x="350" y="540" width="140" height="40" class="process" />
    <text x="420" y="555" text-anchor="middle" class="component-text">レイヤー処理</text>
    <text x="420" y="570" text-anchor="middle" class="small-text">解凍、展開</text>
    
    <!-- Storage Integration -->
    <rect x="510" y="540" width="140" height="40" class="process" />
    <text x="580" y="555" text-anchor="middle" class="component-text">ストレージ統合</text>
    <text x="580" y="570" text-anchor="middle" class="small-text">OverlayFS mount</text>
    
    <!-- Image Ready -->
    <rect x="670" y="540" width="120" height="40" class="process" />
    <text x="730" y="555" text-anchor="middle" class="component-text">イメージ完成</text>
    <text x="730" y="570" text-anchor="middle" class="small-text">実行可能状態</text>
  </g>

  <!-- Network Communication -->
  <g id="network-flow">
    <!-- Registry to Podman arrows -->
    <defs>
      <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
        <polygon points="0 0, 10 3.5, 0 7" class="arrow" />
      </marker>
      <marker id="flow-arrowhead" markerWidth="12" markerHeight="9" refX="12" refY="4.5" orient="auto">
        <polygon points="0 0, 12 4.5, 0 9" class="flow-arrow" />
      </marker>
    </defs>

    <!-- Main flow arrows -->
    <path d="M 250 145 Q 450 100 650 145" stroke-width="3" class="flow-arrow" fill="none" marker-end="url(#flow-arrowhead)" />
    <text x="450" y="115" text-anchor="middle" class="small-text">1. Manifest Request</text>
    
    <path d="M 250 200 Q 450 150 650 200" stroke-width="2" class="flow-arrow" fill="none" marker-end="url(#flow-arrowhead)" />
    <text x="450" y="165" text-anchor="middle" class="small-text">2. Layer Download</text>

    <!-- Process flow arrows -->
    <line x1="130" y1="480" x2="190" y2="540" stroke-width="2" class="arrow" marker-end="url(#arrowhead)" />
    <line x1="190" y1="480" x2="260" y2="540" stroke-width="2" class="arrow" marker-end="url(#arrowhead)" />
    <line x1="300" y1="480" x2="420" y2="540" stroke-width="2" class="arrow" marker-end="url(#arrowhead)" />
    <line x1="470" y1="480" x2="580" y2="540" stroke-width="2" class="arrow" marker-end="url(#arrowhead)" />
    <line x1="640" y1="480" x2="730" y2="540" stroke-width="2" class="arrow" marker-end="url(#arrowhead)" />

    <!-- Sequential arrows -->
    <line x1="170" y1="560" x2="190" y2="560" stroke-width="1" class="arrow" marker-end="url(#arrowhead)" />
    <line x1="330" y1="560" x2="350" y2="560" stroke-width="1" class="arrow" marker-end="url(#arrowhead)" />
    <line x1="490" y1="560" x2="510" y2="560" stroke-width="1" class="arrow" marker-end="url(#arrowhead)" />
    <line x1="650" y1="560" x2="670" y2="560" stroke-width="1" class="arrow" marker-end="url(#arrowhead)" />
  </g>

  <!-- Performance Notes -->
  <g id="performance-notes" transform="translate(50, 610)">
    <text x="0" y="0" class="step-title">パフォーマンス最適化:</text>
    <text x="0" y="20" class="small-text">• 並列ダウンロード（複数レイヤー同時）  • デルタ同期（差分のみ）  • レイヤーキャッシュ活用  • 圧縮最適化</text>
    
    <text x="0" y="50" class="step-title">セキュリティ検証:</text>
    <text x="0" y="70" class="small-text">• SHA256チェックサム検証  • GPG署名確認  • Content Trust  • 脆弱性スキャン統合</text>
  </g>
</svg>