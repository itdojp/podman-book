<svg width="900" height="750" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font: 700 18px Inter, sans-serif; fill: var(--color-text-primary, #1a202c); }
      .section-title { font: 600 14px Inter, sans-serif; fill: var(--color-text-primary, #1a202c); }
      .layer-text { font: 500 12px Inter, sans-serif; fill: var(--color-text-primary, #1a202c); }
      .component-text { font: 400 11px Inter, sans-serif; fill: var(--color-text-secondary, #4a5568); }
      .small-text { font: 400 10px Inter, sans-serif; fill: var(--color-text-secondary, #4a5568); }
      
      .user-context { fill: var(--color-blue-50, #ebf8ff); stroke: var(--color-blue-200, #90cdf4); }
      .selinux { fill: var(--color-green-50, #f0fff4); stroke: var(--color-green-200, #68d391); }
      .capabilities { fill: var(--color-orange-50, #fffaf0); stroke: var(--color-orange-200, #fbb962); }
      .seccomp { fill: var(--color-purple-50, #faf5ff); stroke: var(--color-purple-200, #c084fc); }
      .namespace { fill: var(--color-yellow-50, #fffff0); stroke: var(--color-yellow-200, #f6e05e); }
      .cgroup { fill: var(--color-red-50, #fef5e7); stroke: var(--color-red-200, #fc8181); }
      .container { fill: var(--color-indigo-50, #f0f9ff); stroke: var(--color-indigo-200, #a5b4fc); }
      .arrow { stroke: var(--color-gray-600, #718096); fill: var(--color-gray-600, #718096); }
      .flow { stroke: var(--color-blue-500, #3182ce); stroke-width: 2; }
    </style>
  </defs>

  <!-- Title -->
  <text x="450" y="30" text-anchor="middle" class="title">Podman セキュリティコンテキスト フロー図</text>

  <!-- User Context -->
  <g id="user-context">
    <text x="450" y="70" text-anchor="middle" class="section-title">1. ユーザーコンテキスト</text>
    
    <rect x="200" y="90" width="500" height="80" class="user-context" />
    <text x="450" y="110" text-anchor="middle" class="layer-text">User Context & Rootless Operation</text>
    
    <rect x="220" y="120" width="120" height="40" class="user-context" />
    <text x="280" y="135" text-anchor="middle" class="component-text">Host User</text>
    <text x="280" y="150" text-anchor="middle" class="small-text">uid=1000</text>
    
    <rect x="360" y="120" width="120" height="40" class="user-context" />
    <text x="420" y="135" text-anchor="middle" class="component-text">Container User</text>
    <text x="420" y="150" text-anchor="middle" class="small-text">uid=0 (mapped)</text>
    
    <rect x="500" y="120" width="120" height="40" class="user-context" />
    <text x="560" y="135" text-anchor="middle" class="component-text">Subuid/Subgid</text>
    <text x="560" y="150" text-anchor="middle" class="small-text">100000-165535</text>
  </g>

  <!-- Security Layers -->
  <g id="security-layers">
    <text x="450" y="210" text-anchor="middle" class="section-title">2. セキュリティレイヤー</text>
    
    <!-- SELinux -->
    <rect x="50" y="230" width="160" height="100" class="selinux" />
    <text x="130" y="250" text-anchor="middle" class="layer-text">SELinux</text>
    <text x="130" y="270" text-anchor="middle" class="small-text">強制アクセス制御</text>
    <text x="130" y="285" text-anchor="middle" class="small-text">container_t</text>
    <text x="130" y="300" text-anchor="middle" class="small-text">svirt_sandbox_file_t</text>
    <text x="130" y="315" text-anchor="middle" class="small-text">Label分離</text>
    
    <!-- Capabilities -->
    <rect x="230" y="230" width="160" height="100" class="capabilities" />
    <text x="310" y="250" text-anchor="middle" class="layer-text">Capabilities</text>
    <text x="310" y="270" text-anchor="middle" class="small-text">権限の細分化</text>
    <text x="310" y="285" text-anchor="middle" class="small-text">CAP_NET_BIND_SERVICE</text>
    <text x="310" y="300" text-anchor="middle" class="small-text">CAP_CHOWN</text>
    <text x="310" y="315" text-anchor="middle" class="small-text">最小権限原則</text>
    
    <!-- Seccomp -->
    <rect x="410" y="230" width="160" height="100" class="seccomp" />
    <text x="490" y="250" text-anchor="middle" class="layer-text">Seccomp</text>
    <text x="490" y="270" text-anchor="middle" class="small-text">システムコール制限</text>
    <text x="490" y="285" text-anchor="middle" class="small-text">Default Profile</text>
    <text x="490" y="300" text-anchor="middle" class="small-text">Custom Filter</text>
    <text x="490" y="315" text-anchor="middle" class="small-text">攻撃面削減</text>
    
    <!-- AppArmor -->
    <rect x="590" y="230" width="160" height="100" class="selinux" />
    <text x="670" y="250" text-anchor="middle" class="layer-text">AppArmor</text>
    <text x="670" y="270" text-anchor="middle" class="small-text">パス制御</text>
    <text x="670" y="285" text-anchor="middle" class="small-text">Profile適用</text>
    <text x="670" y="300" text-anchor="middle" class="small-text">File Access</text>
    <text x="670" y="315" text-anchor="middle" class="small-text">Network制限</text>
  </g>

  <!-- Namespace Isolation -->
  <g id="namespace-isolation">
    <text x="450" y="370" text-anchor="middle" class="section-title">3. Namespace分離</text>
    
    <rect x="100" y="390" width="140" height="80" class="namespace" />
    <text x="170" y="410" text-anchor="middle" class="layer-text">PID Namespace</text>
    <text x="170" y="430" text-anchor="middle" class="small-text">プロセス分離</text>
    <text x="170" y="445" text-anchor="middle" class="small-text">PID 1 = init</text>
    <text x="170" y="460" text-anchor="middle" class="small-text">Kill防止</text>
    
    <rect x="260" y="390" width="140" height="80" class="namespace" />
    <text x="330" y="410" text-anchor="middle" class="layer-text">Network NS</text>
    <text x="330" y="430" text-anchor="middle" class="small-text">ネットワーク分離</text>
    <text x="330" y="445" text-anchor="middle" class="small-text">仮想インターフェース</text>
    <text x="330" y="460" text-anchor="middle" class="small-text">独立ルーティング</text>
    
    <rect x="420" y="390" width="140" height="80" class="namespace" />
    <text x="490" y="410" text-anchor="middle" class="layer-text">Mount NS</text>
    <text x="490" y="430" text-anchor="middle" class="small-text">ファイルシステム</text>
    <text x="490" y="445" text-anchor="middle" class="small-text">独立マウント</text>
    <text x="490" y="460" text-anchor="middle" class="small-text">rootfs分離</text>
    
    <rect x="580" y="390" width="140" height="80" class="namespace" />
    <text x="650" y="410" text-anchor="middle" class="layer-text">User NS</text>
    <text x="650" y="430" text-anchor="middle" class="small-text">UID/GID分離</text>
    <text x="650" y="445" text-anchor="middle" class="small-text">Rootless実行</text>
    <text x="650" y="460" text-anchor="middle" class="small-text">権限昇格防止</text>
  </g>

  <!-- Resource Control -->
  <g id="resource-control">
    <text x="450" y="510" text-anchor="middle" class="section-title">4. リソース制御 (cgroups)</text>
    
    <rect x="150" y="530" width="200" height="80" class="cgroup" />
    <text x="250" y="550" text-anchor="middle" class="layer-text">CPU & Memory Control</text>
    <text x="250" y="570" text-anchor="middle" class="small-text">--cpus=2.0 --memory=1g</text>
    <text x="250" y="585" text-anchor="middle" class="small-text">リソース枯渇防止</text>
    <text x="250" y="600" text-anchor="middle" class="small-text">DoS攻撃対策</text>
    
    <rect x="370" y="530" width="200" height="80" class="cgroup" />
    <text x="470" y="550" text-anchor="middle" class="layer-text">I/O & PID Control</text>
    <text x="470" y="570" text-anchor="middle" class="small-text">--pids-limit=100</text>
    <text x="470" y="585" text-anchor="middle" class="small-text">Fork bomb防止</text>
    <text x="470" y="600" text-anchor="middle" class="small-text">ディスクI/O制限</text>
  </g>

  <!-- Container Security -->
  <g id="container-security">
    <text x="450" y="650" text-anchor="middle" class="section-title">5. コンテナセキュリティ適用</text>
    
    <rect x="200" y="670" width="500" height="60" class="container" />
    <text x="450" y="690" text-anchor="middle" class="layer-text">Secured Container Runtime</text>
    <text x="250" y="710" text-anchor="middle" class="small-text">全セキュリティレイヤー統合</text>
    <text x="450" y="710" text-anchor="middle" class="small-text">Defense in Depth</text>
    <text x="650" y="710" text-anchor="middle" class="small-text">Zero Trust Architecture</text>
  </g>

  <!-- Security Commands -->
  <g id="security-commands" transform="translate(50, 750)">
    <text x="0" y="0" class="section-title">セキュリティ設定コマンド例</text>
    <text x="0" y="20" class="small-text">podman run --security-opt label=type:container_runtime_t --cap-drop=ALL --cap-add=NET_BIND_SERVICE</text>
    <text x="0" y="35" class="small-text">podman run --userns=keep-id --security-opt seccomp=custom.json --read-only --tmpfs /tmp</text>
  </g>

  <!-- Flow arrows -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" class="arrow" />
    </marker>
  </defs>

  <!-- Vertical flow -->
  <line x1="450" y1="180" x2="450" y2="210" class="flow" marker-end="url(#arrowhead)" />
  <line x1="450" y1="340" x2="450" y2="370" class="flow" marker-end="url(#arrowhead)" />
  <line x1="450" y1="480" x2="450" y2="510" class="flow" marker-end="url(#arrowhead)" />
  <line x1="450" y1="620" x2="450" y2="650" class="flow" marker-end="url(#arrowhead)" />

  <!-- Security layer integration -->
  <line x1="130" y1="340" x2="400" y2="390" class="flow" />
  <line x1="310" y1="340" x2="450" y2="390" class="flow" />
  <line x1="490" y1="340" x2="500" y2="390" class="flow" />
  <line x1="670" y1="340" x2="550" y2="390" class="flow" />

  <!-- Namespace to cgroups -->
  <line x1="330" y1="480" x2="350" y2="530" class="flow" />
  <line x1="490" y1="480" x2="470" y2="530" class="flow" />
</svg>